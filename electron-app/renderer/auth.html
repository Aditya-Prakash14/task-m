<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Todo Calendar - Login</title>
  <link rel="stylesheet" href="css/styles.css">
  <style>
    .auth-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 2rem;
    }

    .auth-box {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 450px;
      padding: 2.5rem;
    }

    .auth-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    .auth-header h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      color: var(--primary-color);
    }

    .auth-header p {
      color: var(--text-secondary);
    }

    .auth-tabs {
      display: flex;
      gap: 1rem;
      margin-bottom: 2rem;
      border-bottom: 2px solid var(--border-color);
    }

    .auth-tab {
      flex: 1;
      padding: 0.75rem;
      background: none;
      border: none;
      font-size: 1rem;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      position: relative;
      transition: color 0.2s;
    }

    .auth-tab.active {
      color: var(--primary-color);
    }

    .auth-tab.active::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background-color: var(--primary-color);
    }

    .auth-form {
      display: none;
    }

    .auth-form.active {
      display: block;
    }

    .alert {
      padding: 0.75rem 1rem;
      border-radius: 0.375rem;
      margin-bottom: 1rem;
    }

    .alert-error {
      background-color: #fee2e2;
      color: #991b1b;
      border: 1px solid #fecaca;
    }

    .alert-success {
      background-color: #d1fae5;
      color: #065f46;
      border: 1px solid #a7f3d0;
    }
  </style>
</head>
<body>
  <div class="auth-container">
    <div class="auth-box">
      <div class="auth-header">
        <h1>ðŸ“… Todo Calendar</h1>
        <p>Manage your tasks and schedule efficiently</p>
      </div>

      <div class="auth-tabs">
        <button class="auth-tab active" data-tab="login">Login</button>
        <button class="auth-tab" data-tab="register">Register</button>
      </div>

      <div id="alert-container"></div>

      <!-- Login Form -->
      <form id="login-form" class="auth-form active">
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" id="login-email" required>
        </div>

        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-control" id="login-password" required>
        </div>

        <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
          Login
        </button>
      </form>

      <!-- Register Form -->
      <form id="register-form" class="auth-form">
        <div class="form-group">
          <label class="form-label">Name</label>
          <input type="text" class="form-control" id="register-name" required>
        </div>

        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" id="register-email" required>
        </div>

        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" class="form-control" id="register-password" required minlength="6">
          <small style="color: var(--text-secondary);">Minimum 6 characters</small>
        </div>

        <div class="form-group">
          <label class="form-label">Timezone</label>
          <select class="form-control" id="register-timezone">
            <option value="UTC">UTC</option>
            <option value="America/New_York">America/New_York</option>
            <option value="America/Chicago">America/Chicago</option>
            <option value="America/Los_Angeles">America/Los_Angeles</option>
            <option value="Europe/London">Europe/London</option>
            <option value="Europe/Paris">Europe/Paris</option>
            <option value="Asia/Tokyo">Asia/Tokyo</option>
            <option value="Asia/Shanghai">Asia/Shanghai</option>
            <option value="Asia/Kolkata">Asia/Kolkata</option>
            <option value="Australia/Sydney">Australia/Sydney</option>
          </select>
        </div>

        <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;">
          Create Account
        </button>
      </form>
    </div>
  </div>

  <script src="js/api.js"></script>
  <script>
    // Tab switching
    const tabs = document.querySelectorAll('.auth-tab');
    const forms = document.querySelectorAll('.auth-form');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.dataset.tab;
        
        tabs.forEach(t => t.classList.remove('active'));
        forms.forEach(f => f.classList.remove('active'));
        
        tab.classList.add('active');
        document.getElementById(`${tabName}-form`).classList.add('active');
        
        clearAlert();
      });
    });

    // Alert functions
    function showAlert(message, type = 'error') {
      const alertContainer = document.getElementById('alert-container');
      alertContainer.innerHTML = `
        <div class="alert alert-${type}">
          ${message}
        </div>
      `;
    }

    function clearAlert() {
      document.getElementById('alert-container').innerHTML = '';
    }

    // Login form handler
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      clearAlert();

      const email = document.getElementById('login-email').value;
      const password = document.getElementById('login-password').value;

      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Logging in...';

      try {
        const response = await api.login({ email, password });
        
        if (response.success) {
          showAlert('Login successful! Redirecting...', 'success');
          setTimeout(() => {
            window.electronAPI.navigateTo('dashboard');
          }, 1000);
        }
      } catch (error) {
        showAlert(error.message || 'Login failed. Please check your credentials.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Login';
      }
    });

    // Register form handler
    document.getElementById('register-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      clearAlert();

      const name = document.getElementById('register-name').value;
      const email = document.getElementById('register-email').value;
      const password = document.getElementById('register-password').value;
      const timezone = document.getElementById('register-timezone').value;

      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Creating account...';

      try {
        const response = await api.register({ name, email, password, timezone });
        
        if (response.success) {
          showAlert('Account created successfully! Redirecting...', 'success');
          setTimeout(() => {
            window.electronAPI.navigateTo('dashboard');
          }, 1000);
        }
      } catch (error) {
        showAlert(error.message || 'Registration failed. Please try again.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Create Account';
      }
    });
  </script>
</body>
</html>
